<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui.min.css">
		<link href="../css/mui.listpicker.css" rel="stylesheet" />
		<link href="../css/mui.poppicker.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/bbsapp.css" />
		<link rel="stylesheet" href="../dist/css/wangEditor.min.css" />
		<!--App自定义的css-->
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">创建话题</h1>
			<a href="javascript:save();" class="mui-pull-right" style="line-height: 44px;margin-right: 5px;">提交</a>
		</header>
		<div class="mui-content" style="margin: 10px;">
			<div class="form-group">
					<input type="hidden" id="sid" value="4">
						<button id='showSectionPicker' class="mui-btn mui-btn-block" type='button'>灌水</button>
 
			
			</div>
			<div class="form-group">
				<input type="text" id="title" value="" placeholder="标题10字以上" class="form-control">
			</div>
			<div class="form-group">
		
		<textarea placeholder="内容" rows="3" id="content" name="content" style="height: 400px;" class="form-control"></textarea>
			</div>
			<!--<div class="mui-input-group">
				<div class="mui-input-row">
					<input type="hidden" id="sid" value="8">
					<input type="text" id="showSectionPicker" disabled="disabled" value="灌水">
				</div>
				<div class="mui-input-row">
					<input type="text" id="title" value="" placeholder="标题10字以上">
				</div>
			</div>
			<div class="mui-input-row">
				<textarea placeholder="内容" rows="5" id="content" name="content" style="height: 400px;"></textarea>
			</div>-->
		</div>
			</body>
		<script src="../js/mui.min.js"></script>
		<script src="../js/jquery.min.js"></script>
		<script src="../js/mui.listpicker.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script src="../js/bbscommon.js"></script>
		<script src="../dist/js/wangEditor.min.js"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init();
			var sectionPicker = new mui.PopPicker();
			var pickerData = [];
			mui.plusReady(function() {
				getSection();
				var editor = new wangEditor("content");
        			// 自定义菜单
		        editor.config.menus = [
		            'bold',
		            'underline',
		            'italic',
		            'forecolor',
		            'bgcolor',
		            'quote',
		            'fontsize',
		            'head',
		            'unorderlist',
		            'img'
		        ];
		        editor.config.uploadImgUrl = _url + '/upload';
		        editor.create();
			});
			function getSection() {
		
				mui.ajax({
					url: _baseUrl + '/Getf_section',
//					data:{
//						token:""
//					},
					dataType: 'json',
					async: true,
					type: 'get',
					success: function(data) {
						if(data.code == 200) {
							$.each(data.detail, function(index, _data) {
								pickerData.push({value: _data.id, text: _data.name});
							});
							sectionPicker.setData(pickerData);
						
						} else {
							plus.nativeUI.alert(data.description);
						}
					},error:function(xhr,type,errorThrown) {
				console.log(type)
			}
				})
			}
			var showSectionPickerButton = document.getElementById('showSectionPicker');
			showSectionPickerButton.addEventListener('tap', function(event) {
				sectionPicker.show(function(items) {
					console.log(items[0].value);
					document.getElementById("sid").value = items[0].value;
					showSectionPickerButton.innerHTML=items[0].text;
				});
			}, false);
		
			function save() {
				
				var sid = document.getElementById("sid");
				var title = document.getElementById("title");
				var content = document.getElementById("content");
				if(trim(title.value).length == 0) {
					mui.toast("标题不能为空");
				} else if(trim(content.value).length == 0) {
					mui.toast("请输入内容");
				} else {
					 mui.ajax({
						type: "post",
						url: _baseUrl + "/Getf_topicCreate",
						data: {
							token: plus.storage.getItem(_user_token),
							title: title.value,
							sid: sid.value,
							coutent: content.value	
						},
						async: true,
						dataType: "json",
						success: function(data) {
							//console.log(data.detail.id)
							if(data.code == 200) {
								title.value = "";
								content.value = "";
								mui.toast(data.description);
							} else {
								mui.toast(data.description);
							}
						},
					error:function(xhr,type,errorThrown){
						//异常处理；
						console.log(type);
						}
					});
				}
			}
		</script>


</html>